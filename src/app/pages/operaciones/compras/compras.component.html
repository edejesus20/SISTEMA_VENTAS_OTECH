<ng-template [ngIf]="!noestasPermitido">


<div style="max-width:160rem"> 
    <ng-template [ngIf]="!CrearCompra">
      <br>
  <div class="px-4 py-5 md:px-4 lg:px-4 surface-section min-h-screen" style="border-radius: 7px;">
      <!-- crear nuevo -->
      <div class="flex flex-column lg:flex-row lg:align-items-center 
      lg:justify-content-between relative" 
      style="top:-20px">
          <div>
              <div class=" mr-3 surface-card shadow-2 flex align-items-center justify-content-center p-2" 
              style="width: auto; height: auto; max-width:600px; border-radius: 10px;">
              <div class="logo-text font-family" @fadeInOut >Registro de Compras</div>
              <!-- <img src="assets/almacenamiento.jpg" alt="Image" width="100" height="70"> -->
              </div>
              <!-- <div class="text-900 text-3xl font-medium mb-3">Company Name</div> -->
              <div class="text-600 font-medium">
                      <!-- <span>c</span> -->
              </div>
          </div>
          <div class="mt-3 lg:mt-0">
              <button pbutton="" pripple="" label="Follow" 
              *ngIf="estadoCaja"
              icon="pi pi-plus-circle" (click)="openNew()"
              class="p-element p-ripple  mr-2 p-button p-button1 p-component">
              <span class="p-button-icon p-button-icon-left pi pi-plus-circle" aria-hidden="true"></span>
              <span class="p-button-label font-family">Registrar Compra</span>
              <span class="p-ink" style="height: 116px; width: 116px; top: -40.5px; left: 20.375px;"></span>
          </button>
          </div>

      </div>
      <!-- consultas -->
      <!-- <div class="surface-card shadow-2 border-round flex  flex-column md:flex-row">
      <div class="border-bottom-1 md:border-right-1 md:border-bottom-none surface-border flex-auto p-3">
          <div class="flex align-items-center mb-3">
              <i class="pi pi-shopping-cart text-orange-500 text-xl mr-2"></i>
              <span class="text-500 font-medium font-family">Compras pagadas</span>
          </div>
          <div class="flex align-items-center">
              <i class="pi pi-arrow-up text-green-500 text-xl mr-2"></i>
              <span class="text-green-500 font-medium font-family">+15</span>
          </div>
      </div>
      <div class="border-bottom-1 md:border-right-1 md:border-bottom-none surface-border flex-auto p-3">
          <div class="flex align-items-center mb-3">
              <i class="pi pi-shopping-cart text-blue-500 text-xl mr-2"></i>
              <span class="text-500 font-medium font-family">Compras en deuda</span>
          </div>
          <div class="flex align-items-center">
              <i class="pi pi-arrow-up text-green-500 text-xl mr-2"></i>
              <span class="text-green-500 font-medium font-family">+5</span>
          </div>
      </div>
      <div class="border-bottom-1 md:border-right-1 md:border-bottom-none surface-border flex-auto p-3">
          <div class="flex align-items-center mb-3">
              <i class="pi pi-shopping-cart text-orange-500 text-xl mr-2"></i>
              <span class="text-500 font-medium font-family">Compras a creditos</span>
          </div>
          <div class="flex align-items-center">
              <i class="pi pi-arrow-up text-green-500 text-xl mr-2"></i>
              <span class="text-green-500 font-medium font-family">+55</span>
          </div>
      </div>
      <div class="border-bottom-1 md:border-right-1 md:border-bottom-none surface-border flex-auto p-3">
        <div class="flex align-items-center mb-3">
            <i class="pi pi-shopping-cart text-blue-500 text-xl mr-2"></i>
            <span class="text-500 font-medium font-family">Compras al contado</span>
        </div>
        <div class="flex align-items-center">
            <i class="pi pi-arrow-up text-green-500 text-xl mr-2"></i>
            <span class="text-green-500 font-medium font-family">+50</span>
        </div>
    </div>
      </div> -->
  <br>
<hr>
<br>
<br>


<div class="grid">
  <div class="col-12 sm:col-7 md:col-7">
    <div style="width:100%" class="mt-3">
      <span class="p-input-icon-left" style="width: 100%;" >
          <i class="pi pi-search"></i>
          <input type="text" pInputText placeholder="Buscador..." 
          class="font-family" style="width: 100%"
          [(ngModel)]="valorbuscado"
          (input)="buscarServicioVentas($event)"
          (keydown)="buscarServicioVentas($event)"  />
      </span>
  </div>
  </div>
  <div class="col-12 sm:col-5 md:col-5">
    <div class="flex align-items-center mt-3 ">

    
    <div class="mb-3 ml-3 ">

      <button pbutton="" pripple="" icon="pi pi-file"  (click)="dt1.exportCSV()"
      pTooltip="CSV" tooltipPosition="bottom"
      class="p-ripple p-element p-button-rounded  mr-2 p-button2 p-button 
      p-component p-button-icon-only"><span class="p-ink"></span>
      <span class="p-button-icon pi pi-file" aria-hidden="true"></span>
      <span aria-hidden="true" class="p-button-label">&nbsp;</span>
      </button>
      <button pbutton="" pripple="" icon="pi  pi-file-excel"  (click)="exportExcel()"
      pTooltip="XLS" tooltipPosition="bottom"
      class="p-ripple p-element p-button-rounded  mr-2 p-button2 p-button 
      p-component p-button-icon-only"><span class="p-ink"></span>
      <span class="p-button-icon pi pi-file-excel" aria-hidden="true"></span>
      <span aria-hidden="true" class="p-button-label">&nbsp;</span>
      </button>
      <button pbutton="" pripple="" icon="pi  pi pi-file-pdf"  (click)="gerenratePdf()"
      pTooltip="PDF" tooltipPosition="bottom"
      class="p-ripple p-element p-button-rounded  mr-2 p-button2 p-button 
      p-component p-button-icon-only"><span class="p-ink"></span>
      <span class="p-button-icon pi  pi pi-file-pdf" aria-hidden="true"></span>
      <span aria-hidden="true" class="p-button-label">&nbsp;</span>
      </button>
      <!-- <button type="button" pButton pRipple icon="pi pi-filter" (click)="dt1.exportCSV({selectionOnly:true})" class="p-button-info ml-auto" pTooltip="Selection Only" tooltipPosition="bottom"></button> -->
      </div>
      <!-- editar compra y eliminar -->
      <p-splitButton label="Acciones" [model]="items"
      styleClass="font-family p-button-raised p-button-rounded p-button-outlined 
      p-button-secondary  mr-2 mb-2 ">
      </p-splitButton>
    </div>
  </div>
</div>


<br>
<p-table #dt1 [value]="compras"
selectionMode="multiple" [(selection)]="selectedProducts" 
id="pd1"
dataKey="id" 
[loading]="loading" 
styleClass="p-datatable-customers" [rowHover]="true"
responsiveLayout="scroll" 
[style]="{'width':'100%','display':'grid'}"
[paginator]="false" 
[filterDelay]="0" 

[columns]="cols"
[globalFilterFields]="['numero','fecha_compra','proveedor','tipocompra',
'subtotal','total','estado_compra','valor_deuda','sede']">

<ng-template pTemplate="header">
    <tr class="font-family">
        <th pSortableColumn="numero">
            <div class="flex justify-content-between align-items-center">
                Codigo
                <p-sortIcon field="numero"></p-sortIcon>
      
            </div>
        </th>
        <th pSortableColumn="fecha_compra">
            <div class="flex justify-content-between align-items-center">
                Fecha de Compra
                <p-sortIcon field="fecha_compra"></p-sortIcon>
            </div>
        </th>
        <th pSortableColumn="proveedor">
            <div class="flex justify-content-between align-items-center">
                Proveedores
                <p-sortIcon field="proveedor"></p-sortIcon>
            </div>
        </th>
        <th pSortableColumn="tipocompra">
            <div class="flex justify-content-between align-items-center">
                Forma de Pago
                <p-sortIcon field="tipocompra"></p-sortIcon>
            </div>
        </th>
        <th pSortableColumn="subtotal" *ngIf="Acciones != 3 && Acciones !=  4">
            <div class="flex justify-content-between align-items-center">
                Subtotal
                <p-sortIcon field="subtotal"></p-sortIcon>
            </div>
        </th>
        <th pSortableColumn="total">
            <div class="flex justify-content-between align-items-center">
                Total
                <p-sortIcon field="total"></p-sortIcon>
            </div>
        </th>
        <th pSortableColumn="valor_deuda">
          <div class="flex justify-content-between align-items-center">
            Valor deuda
              <p-sortIcon field="valor_deuda"></p-sortIcon>
          </div>
      </th>
        <ng-template [ngIf]="Acciones ==1">
            <th style="width: 5rem"> Editar</th>
        </ng-template>
        <ng-template [ngIf]="Acciones ==2">
            <th style="width: 5rem"> Facturas</th>
        </ng-template>
        <ng-template [ngIf]="Acciones ==3">
            <th style="width: 5rem" pSortableColumn="status"> Estados</th>
        </ng-template>
        <ng-template [ngIf]="Acciones ==4">
            <th style="width: 5rem"> Detalles</th>
        </ng-template>
        <ng-template [ngIf]="Acciones == 5">
          <th style="width: 5rem"> Actualizar Factura</th>
      </ng-template>
        
    </tr>
</ng-template>
<ng-template pTemplate="body" let-customer let-rowData let-expanded="expanded">
    <tr class="p-selectable-row font-family"  [pSelectableRow]="rowData">
        <td>
            {{customer?.numero | titlecase}}
        </td>
        <td>
            {{customer?.fecha_compra | date}}
        </td>
        <td>
            {{customer?.proveedor.nombre | titlecase}} Nit {{customer?.proveedor.nit }}
        </td>
        <td>
            {{customer?.tipocompra | titlecase}}
        </td>
        <td *ngIf="Acciones != 3 && Acciones !=  4">
            ${{customer?.subtotal | currency:'':'':'0.2-2'}}
        </td>
        <td>
            ${{customer?.total | currency:'':'':'0.2-2'}}
        </td>
        <td>
            ${{customer?.valor_deuda | currency:'':'':'0.2-2'}}
        </td>
       
        <ng-template [ngIf]="Acciones ==1">
        <td style="text-align: center">
            <button pButton type="button"  (click)="editProduct(customer)" class=" p-ripple 
             p-button-rounded p-button p-button2" icon="pi pi-pencil
            "></button>
        </td>
        </ng-template>
        <ng-template [ngIf]="Acciones ==4">
            <td style="text-align: center">
                <button pButton type="button"  (click)="Detalles(customer)" 
                class=" p-ripple 
                 p-button-rounded p-button p-button2" icon="pi pi-eye
                "></button>
            </td>
            </ng-template>
        <ng-template [ngIf]="Acciones ==2">
            <td style="text-align: center">
              <button pButton type="button" (click)="imprimirFactura($event,customer)"
               class=" p-ripple 
               p-button-rounded p-button p-button2" icon="pi pi-print"></button>
          </td>
            </ng-template>
            <ng-template [ngIf]="Acciones ==3">
                <td>{{customer.estado_compra | titlecase}}</td>
                <!-- <td style="text-align: center">
                    <button pButton  class="p-button-rounded p-button-success" disabled *ngIf="customer?.estado == true" 
                    style="padding:5px;border-radius:2px">
                    <span [class]="'customer-badge status-' + customer?.estado">
                        {{customer.status}}
                    </span>

                      
                    </button>
                    <button pButton  class="p-button-rounded p-button-danger" 
                    *ngIf="customer?.estado == false" 
                    
                    style="padding:5px;border-radius:2px" (click)="activar(customer)">
                      
                      <span [class]="'customer-badge status-' + customer?.estado">
                        {{customer.status}}
                    </span>
                    </button>
                    
                </td> -->
        </ng-template>

        <ng-template [ngIf]="Acciones == 5">
          <td style="text-align: center">
            <button pButton type="button" (click)="compraSeleccionada(customer)"
             class=" p-ripple 
             p-button-rounded p-button p-button2" icon="pi pi-file"></button>
        </td>
          </ng-template>

        
    </tr>
</ng-template>
<ng-template pTemplate="emptymessage" style="text-align: center;">
    <tr class="font-family">
        <td colspan="8">No hay registros encontrados</td>
    </tr>
</ng-template>
<ng-template pTemplate="footer">
  <tr class="font-family">
      <td colspan="8">
          <p-paginator [rows]="10" [totalRecords]="paginacion.count" 
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} Registros"
          [pageLinkSize]="5" (onPageChange)="onPageChange($event)"></p-paginator>

      </td>
  </tr>
</ng-template>
</p-table>

</div>
<!-- detalle de compra -->

<!-- Detalle compra -->
<p-dialog 
[resizable]="false" [modal]="true" [showHeader]="false"
[maximizable]="true" appendTo="body" [(visible)]="abrirDetalle" 
[style]="{width: '70%'}" [contentStyle]="{height: 'auto'}" >
<div class="flex align-items-center flex-column lg:flex-row 
lg:justify-content-between mb-3 mt-4 ng-tns-c38-5 ">
    <div class=" font-medium text-2xl text-900 font-family mr-2">
        <i class="pi pi-book text-blue-500 text-xl bg-blue-100 border-round p-2" 
        ></i>
        Detalles de Compra
    </div>
    <div class="mt-3 lg:mt-0">
        <div pButton class="border-1 surface-border surface-card border-round mr-3">
        <i class="pi pi-check-circle text-green-500 text-2xl 
        md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i>
        <div>
            <div class="text-900 font-medium mb-1">Estado de Compra</div>
            <span class="text-600 text-sm hidden md:block">{{DetalleCompra?.estado_compra | titlecase}}</span>
        </div>
        </div>

      

        <!-- <button pButton type="button" *ngIf="editarInventario == false" 
        (click)="consultar()"
        class=" p-ripple
        p-button-outlined p-button-rounded p-button p-button-warning mr-2" icon="pi pi-pencil
        "></button> -->
        <!-- <button pButton type="button" *ngIf="editarInventario == true" 
        (click)="editarInventario=false" class=" p-ripple
        p-button-outlined p-button-rounded p-button p-button-info mr-2" icon="pi pi-replay
        "></button> -->
        <button pbutton="" pripple="" icon="pi pi-times"  style="font-size:10px"
        (click)="abrirDetalle = false"
        class="p-ripple p-element p-button-rounded p-button2 p-button 
        p-component p-button-icon-only mr-2"><span class="p-ink"></span>
        <span class="p-button-icon pi pi-times" aria-hidden="true"></span>
        <span aria-hidden="true" class="p-button-label">&nbsp;</span>
        </button>
    </div>
  
</div>


    <div class="grid">
        <div class="col-12">
            <div class="shadow-2 surface-card border-round p-4 h-full">
                <div class="grid">
                    <div class="col-12 md:col-4">
                        <div class="flex align-items-center mb-1">
                            <i class="pi pi-tags text-blue-500 text-xl bg-blue-100 border-round p-2" ></i>
                
                                <!-- <img src="assets/images/blocks/avatars/circle-big/avatar-m-1.png" width="56" height="56"> -->
                                <div class="ml-3">
                                    <span class="block text-900 mb-1 text-xl font-medium">Numero</span>
                                    <p class="text-600 mt-0 mb-0">{{DetalleCompra?.numero }}</p>
                                </div>
                            </div>
                    </div>
                    <div class="col-12 md:col-4">
                      <div class="flex align-items-center mb-1">
                            <i class="pi pi-shopping-cart text-orange-500 text-xl bg-blue-100 border-round p-2" ></i>
                
                                <!-- <img src="assets/images/blocks/avatars/circle-big/avatar-m-1.png" width="56" height="56"> -->
                                <div class="ml-3">
                                    <span class="block text-900 mb-1 text-xl font-medium">Forma de Pago</span>
                                    <p class="text-600 mt-0 mb-0">{{DetalleCompra?.tipocompra | titlecase}}</p>
                                </div>
                            </div>
                      </div>
                      <div class="col-12 md:col-4">
                        <div class="flex align-items-center mb-1">
                              <i class="pi pi-calendar text-blue-500 text-xl bg-orange-100 border-round p-2" ></i>
                  
                                  <!-- <img src="assets/images/blocks/avatars/circle-big/avatar-m-1.png" width="56" height="56"> -->
                                  <div class="ml-3">
                                      <span class="block text-900 mb-1 text-xl font-medium">Fecha de Compra</span>
                                      <p class="text-600 mt-0 mb-0">{{DetalleCompra?.fecha_compra | date:'d/M/yy, h:mm a'}}</p>
                                  </div>
                              </div>
                        </div>
                </div>
                <hr>
                <div class="flex justify-content-center align-items-center mb-4 mt-2">
                  
                  <i class="pi pi-th-large text-blue-500 text-xl bg-green-100 border-round p-2 mr-2" ></i>

                <span class="block text-900  mb-2 text-xl font-medium">Productos Añadidos</span>
                </div>

                <div fxLayout="row" fxLayoutGap="20px">
                  <div class="table-wrapper" >
                    <p-table [value]="DetalleCompra?.compraDetalle" > 
                      <ng-template pTemplate="header">
                        <tr class="font-family" >
                            <th pSortableColumn="producto_nombre">Producto<p-sortIcon field="producto_nombre"></p-sortIcon></th>
                            <th pSortableColumn="cantidad">Cantidad<p-sortIcon field="cantidad"></p-sortIcon></th>
                            <th pSortableColumn="precio_compra">Precio<p-sortIcon field="precio_compra"></p-sortIcon></th>
                            <th pSortableColumn="descuento">Descuento<p-sortIcon field="descuento"></p-sortIcon></th>
                            <th pSortableColumn="subtotal">Subtotal<p-sortIcon field="subtotal"></p-sortIcon></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData let-item let-expanded="expanded">
                      <tr class="font-family" [pSelectableRow]="rowData">
                          <td >{{item?.producto_nombre| titlecase}}</td>
                          <td >{{item?.cantidad }}</td>
                          <td >$ {{item?.precio_compra |  currency:'':'':'0.2-2'}}</td>
                          <td >{{item?.descuento }}</td>
                          <td >$ {{item?.subtotal |  currency:'':'':'0.2-2'}}</td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage" style="text-align: center;">
                      <tr class="font-family" style="text-align: center;">
                          <td colspan="8">No hay registros encontrados</td>
                      </tr>
                  </ng-template>
                  <ng-template pTemplate="footer">
                    <tr>
                      <td ></td>
                      <td ></td>
                      <td ></td>
                      <td >TOTAL</td>

                      <td >$ {{DetalleCompra?.total |  currency:'':'':'0.2-2'}}</td>
                      
                    </tr>
                </ng-template>
                    </p-table>
                  </div>
                </div>

                <br>
                <div class="flex justify-content-center align-items-center ">
                  <ul class="list-none p-0 m-0 flex flex-column md:flex-row mt-3">
                    <li class="relative mr-0 md:mr-8 flex-auto">
                        <div class="border-2 border-blue-500 surface-card border-round p-3 flex flex-column 
                    md:flex-row align-items-center z-1">
                    <i class="pi pi-users text-orange-600 text-2xl md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i>
                    <div>
                        <div class="text-blue-600 font-medium mb-1">Proveedor</div>
                        <span class="text-600 text-sm hidden md:block">{{DetalleCompra?.proveedor?.nombre}} Nit : {{DetalleCompra?.proveedor?.nit}}</span>
                    </div>
                </div>
                <div class="w-full absolute top-50 left-100 surface-300 hidden md:block" 
                style="transform: translateY(-50%); height: 2px;"></div>
                </li>
                <li class="relative mr-0 md:mr-8 flex-auto">
                  <div class="border-2 border-orange-500 surface-card border-round p-3 flex flex-column 
              md:flex-row align-items-center z-1">
              <i class="pi pi-calendar-times text-red-600 text-2xl md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i>
              <div>
                  <div class="text-blue-600 font-medium mb-1">Fecha Descuento</div>
                  <span class="text-600 text-sm hidden md:block">{{DetalleCompra?.plazo_descuento | date:'d/M/yy, h:mm a'}} </span>
              </div>
          </div> 
          <div class="w-full absolute top-50 left-100 surface-300 hidden md:block" 
          style="transform: translateY(-50%); height: 2px;"></div>
          </li>
                


                <li class="relative mr-0 md:mr-8 flex-auto">
                    <div class="border-2 border-blue-500 surface-card border-round p-3 flex flex-column 
                    md:flex-row align-items-center z-1">
                    <i class="pi pi-money-bill text-orange-600 text-2xl md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i>
                    <div>
                        <div class="text-900 font-medium mb-1">Valor de Deuda</div>
                            <span class="text-600 text-sm hidden md:block">$ {{DetalleCompra?.valor_deuda |  currency:'':'':'0.2-2'}}</span>
                    </div>
                </div>
                </li>
                    
                  </ul>
                </div>
          
                <ng-template [ngIf]="DetalleCompra?.factura != null">
                  <br>
                  <hr>
                  <div class="flex justify-content-center align-items-center mb-4 mt-2">
                    
                    <i class="pi pi-th-large text-blue-500 text-xl bg-green-100 border-round p-2 mr-2" ></i>
              
                  <span class="block text-900  mb-2 text-xl font-medium">Factura Añadida</span>
                  </div>
                  
                  <div class="flex justify-content-center align-items-center mb-4 mt-2">
                    <p-image [src]="DetalleCompra?.factura" alt="Image" width="400" [preview]="true"
                    imageClass="fullscreen ">
                    </p-image>
                  </div>
                </ng-template>
            </div>
        </div>
    </div>
 
</p-dialog>

</ng-template>


<ng-template [ngIf]="CrearCompra">

    <p-card [style]="{'width': '100%', 'margin-top': '2em','padding':'0px'}">
        <form [formGroup]="form" novalidate enctype="multipart/form-data">
        <div class="flex align-items-center flex-column lg:flex-row 
        lg:justify-content-between mb-2  ng-tns-c38-5 " style="padding:-40px">
            <div class=" font-medium text-2xl text-900 font-family mr-2">
                <i class="pi pi-shopping-cart text-orange-500 text-xl bg-blue-100 border-round p-2" 
                ></i>
                <span class="logo-text font-family ml-3" style="font-size:30px" @fadeInOut >Registrar Compra</span>
                <!-- Registrar Venta -->
            </div>
            <div class="lg:mt-0">
              <div class="flex align-items-center flex-column lg:flex-row lg:justify-content-between">
              <div class="field mr-3" style="display:block;">
                <label for="name"><span style="color:red">( * )</span> Fecha de Compra</label>
                <div class="flex font-family">
                  <div style="width:150%">
                  <input type="date" pInputText id="fecha_compra" style="width:auto"
                  name="fecha_compra" formControlName="fecha_compra" required autofocus />
                  <small class="p-error" 
                  *ngIf="submitted && !form.value.fecha_compra">Fecha de Compra is required.</small>
                    </div>
                </div>
              </div>
              <div class="animate__animated animate__flipInY mr-3" 
              style="background:#898989;border-radius: 20px;display:flex;min-width:200px;max-height: 60px;
              box-shadow: 0.063rem 0 1.25rem 0 #8690a3;padding:10px;align-items: center;justify-content:center">
             
              <div class="ml-3" style="margin-top: -45px;">
                <!-- <span class="block logo-text" @fadeInOut style="font-size: 1.6rem">Total Pago</span> -->
                <span class="block logo-text font-medium mb-2" @fadeInOut>Total a Pagar </span>
                <p class="text-900 text-xl">
                  <i class="pi pi-dollar mr-2" style="size: 1rem;color:#22C55E"></i> {{form.value.total |  currency:'':'':'0.2-2'}}
                </p>
            </div>
              
              </div> 
            <button pButton type="button" *ngIf="CrearCompra == true" style="display:block;" 
            (click)="cancelarCompra=true" class=" p-ripple
            p-button-outlined p-button-rounded p-button p-button-info mr-2" icon="pi pi-replay
            "></button>
            </div>
           

            </div>
          
        </div>
    
        <div style="border:1px solid gray; border-radius:5px;padding: 15px">
    
          <div class="grid font-family">
             
              <div class="col-12 md:col-9 sm:col-9">
    
                <div class="grid font-family">
                  <div class="col-12 md:col-6 sm:col-6">
                    <div class="field  font-family">
                      <label for="name"><span style="color:red">( * )</span> Seleccione Proveedor</label>
                      <div class="flex font-family">
                          <div style="width:100%">
                            <ng-template [ngIf]="tipoUser==='ADMINISTRADOR GENERAL' || tipoUser == 'CEO'">
                            <p-dropdown class="visorg500-select-filter " 
                            [options]="proveedores" [filter]="true"
                            formControlName="proveedor" name="proveedor"
                            class="p-inputtext-sm" 
                            label="Seleccione Proveedor" 
                              [style]="{'width':'82%'}"
                              [showClear]="true"
                              optionvalue="id"  optionLabel="status" filterBy="status"
                              placeholder="Seleccione Proveedor" title="Proveedor">
                              <ng-template let-option pTemplate="item">
                                <span >{{option.status | titlecase}}</span>
                            </ng-template>
                            </p-dropdown>
                        
                          <span class="bottomdelete" style="margin-top: -35px;">
                            <button pButton pRipple type="button" icon="pi pi-plus" style="margin-left: 7px;"
                            class="p-button-rounded p-button-outlined" (click)="addProveedor($event)"  ></button>
                            </span>  
                            </ng-template> 
                            <ng-template [ngIf]="tipoUser =='CAJERO'">
                                <p-dropdown class="visorg500-select-filter " 
                                [options]="proveedores" [filter]="true"
                                formControlName="proveedor" name="proveedor"
                                class="p-inputtext-sm" 
                                label="Seleccione Proveedor" 
                                  [style]="{'width':'100%'}"
                                  [showClear]="true"
                                  optionvalue="id"  optionLabel="status" filterBy="status"
                                  placeholder="Seleccione Proveedor" title="Proveedor">
                                  <ng-template let-option pTemplate="item">
                                    <span >{{option.status | titlecase}}</span>
                                </ng-template>
                                </p-dropdown>

                            </ng-template>
                          </div> 
    
                        </div>
                    </div>
                  </div>
                  <div class="col-12 md:col-6 sm:col-6">
                    <div class="field font-family">
                        <label for="name"><span style="color:red">( * )</span> Seleccione Forma de Pago</label>
                        <div class="flex font-family">
                            <div style="width:100%">
                              <p-dropdown class="visorg500-select-filter " 
                              [options]="tipo_compras" [filter]="true"
                              [showClear]="true"
                              name="tipocompra" formControlName="tipocompra"  
                                  label="Seleccione Forma de Pago" 
                                  [style]="{'width':'100%','margin-bottom':'10px'}"
                                  optionvalue="value"  optionLabel="value" filterBy="value"
                                  [required]="true" placeholder="Seleccione Forma de Pago" 
                                  title="Forma de Pago" class="font-family">
                                  <ng-template let-option pTemplate="item">
                                  <span class="font-family">{{option.value | titlecase}} </span>
                              </ng-template>
                              </p-dropdown>
                            </div>
                          </div>
                      </div>
                  </div>
                </div>
                <!-- productos añadidos -->
                <div style="border:1px solid #22C55E; border-radius:5px;padding: 20px">
                    <div class="flex align-items-center flex-column lg:flex-row 
                    lg:justify-content-between mb-2  ng-tns-c38-5 " style="margin-top: -20px;">
                          <div class=" font-medium text-2xl text-900 font-family mr-2 mt-5">
                            <i class="pi pi-tags text-blue-500 text-xl bg-blue-100 border-round p-2"></i>
                            Productos Añadidos
                        </div>
                        <div class="lg:mt-0" >
    
                          <div class="mt-5 animate__animated animate__flipInY mr-3" 
                          style="background:transparent;border-radius: 20px;display:flex;
                          min-width:200px;
                          box-shadow: 0.063rem 0 1.25rem 0 #8690a3;padding:0px;
                          align-items: center;justify-content:center">
                        
                              <div >
    
                                <button  label="Añadir Productos...."   pButton pRipple type="button" 
                                class="p-button-raised p-button-outlined p-button-rounded 
                                p-button-success"
                                icon="pi pi-search" (click)="mostrarDetalleF($event)"></button >
    
    
                                <!-- <span class="p-input-icon-left" style="width:100%" >
                                  <i class="pi pi-search"style="size: 2rem;"></i>
                              <input type="text" pInputText id="numero" 
                              class="p-inputtext-sm w-full" placeholder="Buscar Producto...."
                              formControlName="numero" name="numero" required autofocus />
                                </span> -->
                            </div>
                          
                          </div> 
    
                        </div>
                    
                    </div>
                    <div fxLayout="row" fxLayoutGap="20px">
                      <div class="table-wrapper" >
                        <p-table [value]="DetalleProductos" 
                        *ngIf="mostrar == true" id="pd1"> 
                          <ng-template pTemplate="header">
                            <tr class="font-family" >
                                <th pSortableColumn="producto.nombre">Producto<p-sortIcon field="producto.nombre"></p-sortIcon></th>
                                <th pSortableColumn="cantidad">Cantidad<p-sortIcon field="cantidad"></p-sortIcon></th>
                                <th pSortableColumn="precio_compra">Precio<p-sortIcon field="precio_compra"></p-sortIcon></th>
                                <th pSortableColumn="descuento">Descuento<p-sortIcon field="descuento"></p-sortIcon></th>
                                <th pSortableColumn="subtotal">Subtotal<p-sortIcon field="subtotal"></p-sortIcon></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-item let-expanded="expanded">
                          <tr class="font-family" [pSelectableRow]="rowData">
                
                      <td >{{item?.producto.nombre | titlecase}}</td>
                      <td >{{item?.cantidad }}</td>
                      <td >$ {{item?.precio_compra |  currency:'':'':'0.2-2'}}</td>
                      <td >{{item?.descuento }} %</td>
                      <td >$ {{item?.subtotal |  currency:'':'':'0.2-2'}}</td>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage" style="text-align: center;">
                          <tr class="font-family" style="text-align: center;">
                              <td colspan="8">No hay registros encontrados</td>
                          </tr>
                      </ng-template>
                      <ng-template pTemplate="footer">
                        <tr>
                          <td ></td>
                          <td ></td>
                          <td ></td>
                          <td >TOTAL</td>
    
                          <td >{{this.form.value.total |  currency:'':'':'0.2-2'}}</td>
                           
                        </tr>
                    </ng-template>
                        </p-table>
                      </div>
                    </div>
    
               
    
                </div>
              </div>
              <!-- detalles de factura -->
              <div class="col-12 md:col-3 sm:col-3">
                <div style="border:1px solid gray; border-radius:5px;">
    
                  <p-panel [style]="{'border-radius':'0px'}">
                    <ng-template pTemplate="header">
                      <i class="pi pi-print" style="margin-right: 5px;font-size: 1rem"></i>  Detalles de Factura
                    </ng-template>
    
                  
                    <div class="field font-family">
                      <label for="name"><span style="color:red">( * )</span> Codigo</label>
                      <div style="width:100%">
                      <input type="text" pInputText id="numero" class="p-inputtext-sm" style="width:100%"
                      formControlName="numero" name="numero" required autofocus />
                      <small class="p-error" *ngIf="submitted && !form.value.numero">Codigo is required.</small>
                    </div>
                    </div>
                      <div class="field font-family" >
                        <label for="name"> Plazo de Descuentos</label>
                        <div style="width:100%">
                        <input type="date" pInputText id="plazo_descuento" class="p-inputtext-sm" style="width:100%"
                        formControlName="plazo_descuento" name="plazo_descuento"  />
                      </div>
                      </div>
                    
                    
                    
                    
                      <ng-template [ngIf]="motrar == false">
                  
                      <div class=" field font-family mt-5 animate__animated animate__flipInY mr-3" 
                      
                      style="background:transparent;border-radius: 20px;display:flex;width: 100%;
                      box-shadow: 0.063rem 0 1.25rem 0 #8690a3;padding:0px;
                      align-items: center;justify-content:center">
                            <button  label="Finalizar"   pButton pRipple type="button" 
                            class="p-button-raised p-button-rounded w-full
                            p-button-success" [disabled]="!form.valid || DetalleProductos.length == 0" 
                            (click)="confirmarFinalizar=true"
                            icon="pi pi-print" ></button >
                      
                      </div> 
                    </ng-template>

                    <ng-template [ngIf]="motrar == true">
                      <br>
                      <br>
                      <!-- <p-progressBar [value]="cargando"></p-progressBar> -->
                      <!-- <div fxLayout="row" class="titleCard"style="margin-top: 20px;"> -->
                        <p-progressBar mode="indeterminate"  [style]="{'height': '6px'}"></p-progressBar>
                  
                      <!-- </div> -->
                    
                    </ng-template>
    
                  </p-panel>
                </div>
              </div>
          </div>
        </div>
        </form>
    </p-card>


    <!-- registro de productos -->
<p-dialog [(visible)]="mostrarDetalle" 
[style]="{'height': 'auto','width': '85%'}"  
[resizable]="false" zindex="10000" 
[closable]="false" [closeOnEscape]="false" 
[maximizable]="true" appendTo="body"
[showHeader]="false"
[modal]="true" styleClass="p-fluid border-round">
    <!-- <div class="flex flex-column align-items-center mb-3 mt-4 ng-tns-c38-5 ">
        <div class="font-medium text-2xl text-900 font-family">
            <i class="pi pi-tags text-blue-500 text-xl bg-blue-100 border-round p-2" ></i>
            Registrar Productos a la Venta
        </div>
    </div> -->
    <div class="flex align-items-center flex-column lg:flex-row 
lg:justify-content-between mb-3 mt-4 ng-tns-c38-5 ">
    <div class=" font-medium text-2xl text-900 font-family mr-2">
        <i class="pi pi-tags text-blue-500 text-xl bg-blue-100 border-round p-2" 
        ></i>
        Registrar Productos a la Compra
    </div>
    <div class="flex mt-3 lg:mt-0">
      
        <button pbutton="" pripple="" icon="pi pi-times"  style="font-size:10px"
        (click)="cerrarRegistro=true"
        class="p-ripple p-element p-button-rounded p-button-success p-button 
        p-component p-button-icon-only mr-2"><span class="p-ink"></span>
        <span class="p-button-icon pi pi-times" aria-hidden="true"></span>
        <span aria-hidden="true" class="p-button-label">&nbsp;</span>
        </button>
    </div>
  
</div>
    <form [formGroup]="formDetalle" novalidate>

      <div class="grid mt-4">
        <div class="col-12 sm:col-8">

        <div class="field font-family animate__animated animate__flipInY "
        style="border-radius: 20px;
          min-width:200px;
          box-shadow: 0.063rem 0 1.25rem 0 #8690a3;padding:0px;">
          <div style="width:100%" >
            <!-- <span class="p-input-icon-left" style="width:100%" >
                  <i class="pi pi-search" style="size: 2rem;"></i> -->

                  <p-dropdown class="visorg500-select-filter " 
                  [options]="productos" [filter]="true"
                  class=" p-inputtext-sm font-family" 
                  label="Buscador..." 
                  formControlName="buscador" name="buscador"
                  appendTo="body"
                  dropdownIcon="pi pi-search"
                  [showClear]="true"
                    [style]="{'width':'100%'}"
                    optionvalue="id"  optionLabel="status" filterBy="status"
                    placeholder="Buscador..." title="Buscador..." (onChange)="anadrirProducto()">
                    <ng-template pTemplate="filter" let-options="options">
                      <div class="flex p-3">
                          <div class="p-inputgroup" (click)="buscarServicio($event)">
                              <span class="p-inputgroup-addon"><i class="pi pi-search"></i></span>
                              <input type="text" pInputText placeholder="Filtrado mas de 3 caracteres..." 
                              (input)="buscarServicio($event)"
                              (keydown)="buscarServicio($event)"
                              >
                          </div>
                          <!--  (onFilter)="buscarServicio($event)" -->
                          <!-- <button pButton icon="pi pi-times" class="ml-3" (click)="myResetFunction(options)"></button> -->
                      </div>
                  </ng-template>
                    <ng-template let-option pTemplate="item">
                      <span class="font-family">
                        {{option.status | titlecase}}</span>
                  </ng-template>
                  </p-dropdown>
            
            </div>
          </div>

        </div>
        <div class="col-12 sm:col-4">
          <div class="field font-family">
            <!-- <label for="name">Escanear Codigo Barra</label> -->
            <div style="width:100%">
                <button pbutton="" pripple="" label="Follow" 
              icon="pi pi-plus" (click)="addProductos($event)"
              class="p-element p-ripple p-button-outlined mr-2 p-button p-component">
              <span class="p-button-icon p-button-icon-left pi pi-plus" aria-hidden="true"></span>
              <span class="p-button-label font-family">Registrar Nuevo Producto</span>
              <span class="p-ink" style="height: 116px; width: 116px; top: -40.5px; left: 20.375px;"></span>
          </button>

          </div>
          </div>
        </div>
      </div>


      <br>

    
        <p-table [value]="algo" #dt2
        styleClass="p-datatable-customers" [rowHover]="true"
        responsiveLayout="scroll"     [filterDelay]="0" 
        > 
          <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="id">Detalle de Productos Añadidos<p-sortIcon field="id"></p-sortIcon></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-item let-expanded="expanded">
          <tr [pSelectableRow]="rowData">
              <td *ngIf="mostrar == true">
                <div formArrayName="compraDetalle"> 
                  <div *ngFor="let item of getDetVentas.controls; 
                  let pointIndex=index" [formGroupName]="pointIndex">
                
                    <div class="grid " [style]="{'margin-top':'5px'}" (click)="verificar()">
                      <div class="col-12 sm:col-11 md:col-11 lg:col-11">
                        <div class="grid">
                          <div class="col-2 ">
                            <div class="field">
                              <label for="name" style="font-weight: bold;">Producto</label>
                              <input type="text" pInputText  class="p-inputtext-sm" 
                              value="{{getDetVentas.value[pointIndex].producto.nombre | titlecase}}" name="producto" [disabled]='true'/>
                            </div>
                          </div>
                          <div class="col-3 ">
                            <div class="field">
                              <label for="stacked" style="font-weight: bold;">
                                <span style="color:red">( * )</span> Precio de Compra</label>
                              <p-inputNumber formControlName="precio_compra" 
                              name="precio_compra" [required]="true"  class="p-inputtext-sm" 
                              [showButtons]="false" 
                              mode="decimal"  [minFractionDigits]="2"
                               autofocus 
                              (keyup)="verificar()" (click)="verificar()">
                              </p-inputNumber>
                              <!-- <label for="name">Precio</label>
                              <input type="text" pInputText formControlName="precio" name="precio" required 
                              autofocus /> -->
                            </div>
                          </div>
                          <div class="col-2 ">
                            <div class="field">
                              <label for="minmax-buttons" style="font-weight: bold;"><span style="color:red">( * )</span> Cantidad</label>
                              <p-inputNumber  formControlName="cantidad" name="cantidad"  
                              class="p-inputtext-sm" 
                              [required]="true" inputId="integeronly"  [showButtons]="false" 
                              inputId="minmax-buttons" 
                              [min]="1"  autofocus
                              (keyup)="verificar()" (click)="verificar()">
                              </p-inputNumber>
                            
                              <!-- <input type="text" pInputText formControlName="cantidad" name="cantidad" required 
                              autofocus /> -->
                            </div>
                          </div>
                          <div class="col-3 "style=display:flex>

                              <!-- <ng-template [ngIf]="validandoCertificado[pointIndex] == true"> -->
                                <div class="field" style="width:80%" >
                                  <label for="name" style="font-weight: bold;">Descuento</label>
                                <p-inputNumber formControlName="descuento" name="descuento" 
                                [required]="true"   class="p-inputtext-sm" 
                                [showButtons]="true" buttonLayout="horizontal" 
                                inputId="horizontal" 
                                spinnerMode="horizontal" [step]="19"
                                decrementButtonClass="p-button-secondary" 
                                incrementButtonClass="p-button-secondary" 
                                incrementButtonIcon="pi pi-plus" 
                                decrementButtonIcon="pi pi-minus" autofocus 
                                (keyup)="verificar()" (click)="verificar()">
                                </p-inputNumber>
                              </div>
       
                              <!-- </ng-template> -->
                          </div>
                         
                          <div class="col-2 ">
                            <div class="field">
                              <label for="name" style="font-weight: bold;">Subtotal</label>
                              <input type="text" pInputText (click)="verificar()"  
                              class="p-inputtext-sm" 
                              value="{{getDetVentas.value[pointIndex].subtotal }}" 
                              name="subtotal" [disabled]='true'
                              
                              autofocus />
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 sm:col-1" style="margin-top: 25px;">
                        <span class="bottomdelete" style="margin-top: 15px;">

                            <button pButton pRipple type="button" icon="pi pi-pencil" 
                            *ngIf="getDetVentas.value[pointIndex].validate ==true"
                            (click)="editProductOne(getDetVentas.value[pointIndex].producto)"  
                            class="p-button-rounded p-button-warning"></button>

                          <button pButton pRipple type="button" icon="pi pi-times" 
                          (click)="removeRoles(pointIndex,$event)"  
                          class="p-button-rounded p-button-danger"></button>
                          <!-- <button pButton type="button" class="p-button-danger p-button-raised p-button-rounded"
                          (click)="removeRoles(pointIndex,$event)" 
                          label="eliminar"></button> -->
                        </span>
                      </div>
                    </div>
                  <hr>
                  </div> 
                </div>
           
              </td>
              <td colspan="8" *ngIf="mostrar != true">
                No hay productos añadidos
              </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="footer">
          <tr>
            <td >TOTAL : {{this.form.value.total |  currency:'':'':'0.2-2'}}</td>
             
          </tr>
      </ng-template>
        </p-table>
        <br>

        <div style="text-align: center;display:flex;justify-content:center;margin-top: 10px;" 
        >
            <button pButton pRipple 
            label="Registrar" icon="pi pi-check" style="width: auto;" 
            class="p-button-success font-family"
            [disabled]="getDetVentas.value[0].subtotal  =='' || 
            getDetVentas.value[0].descuento ==null ||  
            getDetVentas.value[0].precio_compra == null ||
            getDetVentas.value[0].cantidad == null
            " (click)="enviarDatos($event)"></button>

        </div>
 
   
  </form>
</p-dialog>

  <!-- editar y crear productos -->
  <p-dialog
    [(visible)]="productDialogSelect"
    [style]="{ height: 'auto', width: '70%' }"
    [resizable]="false"
    zindex="10000"
    [closable]="false"
    [closeOnEscape]="false"
    [maximizable]="true"
    appendTo="body"
    [showHeader]="false"
    [modal]="true"
    styleClass="p-fluid border-round"
  >
    <div class="flex flex-column align-items-center mb-3 mt-4 ng-tns-c38-5">
      <div class="font-medium text-2xl text-900 font-family">
        <i
          class="pi pi-pencil text-orange-500 text-xl bg-blue-100 border-round p-2"
          *ngIf="nombre == 'Modificar'"
        ></i>
        Modificar Datos del Producto
      </div>
    </div>

    <div class="flex flex-column align-items-center mb-3 mt-4 ng-tns-c38-5">
      <div class="font-medium text-2xl text-900 font-family">
        {{ productoSelect.nombre }}
      </div>
    </div>

    
    <div style="border: 1px solid gray; border-radius: 5px; padding: 25px;">

      <div class="grid font-family">
        <div class="col-12 md:col-6 sm:col-6">
          <div class="field">
            <label for="name">
              <span style="color: red;">( * )</span>
              Precio Manero
            </label>
            <p-inputNumber
              mode="decimal"
              [minFractionDigits]="2"
              id="name"
              [(ngModel)]="productoSelect.precio_venta"
              [required]="true"
              autofocus
            ></p-inputNumber>
   
          </div>
        </div>
        <div class="col-12 md:col-6 sm:col-6">
          <div class="field">
            <label for="name">
              <span style="color: red;">( * )</span>
              Precio Detal
            </label>
            <p-inputNumber
              mode="decimal"
              [minFractionDigits]="2"
              id="name"
              [(ngModel)]="productoSelect.precio_detal"
              [required]="true"
              autofocus
            ></p-inputNumber>

            <small class="p-error" *ngIf="submitted && !productoSelect.precio_detal">
              Precio Detal is required.
            </small>
          </div>
        </div>
      </div>
      <div class="grid font-family">
        <div class="col-12 md:col-6 sm:col-6">
          <div class="field">
            <label for="name">
              <span style="color: red;">( * )</span>
              Precio por Mayor
            </label>
            <p-inputNumber
              mode="decimal"
              [minFractionDigits]="2"
              id="name"
              [(ngModel)]="productoSelect.precio_por_mayor"
              [required]="true"
              autofocus
            ></p-inputNumber>

          </div>
        </div>
        <div class="col-12 md:col-6 sm:col-6">
          <div class="field">
            <label for="name">
              <span style="color: red;">( * )</span>
              Costo
            </label>
            <p-inputNumber
              mode="decimal"
              [minFractionDigits]="2"
              id="name"
              [(ngModel)]="productoSelect.costo"
              [required]="true"
              autofocus
            ></p-inputNumber>
            <small class="p-error" *ngIf="submitted && !productoSelect.costo">
              Costo is required.
            </small>
          </div>
        </div>
      </div>
      <ng-template [ngIf]="motrar == false">

      <div
        style="text-align: center;display: flex;justify-content: center;margin-top: 10px;">
        <button
          pButton
          pRipple
          label="Cancelar"
          icon="pi pi-times"
          style="width: auto;"
          class="p-button-text mr-4 font-family"
          (click)="productDialogSelect = false"
        ></button>
        <button
          pButton
          pRipple
          label="Guardar"
          icon="pi pi-check"
          style="width: auto;"
          class="p-button-success font-family"
          [disabled]="
            !productoSelect.nombre ||
            !productoSelect.precio_venta ||
            !productoSelect.precio_detal ||
            !productoSelect.costo ||
            !productoSelect.precio_por_mayor "
          (click)="Dialog1 = true" ></button>

      </div>

    </ng-template>

    <ng-template [ngIf]="motrar == true">
      <br>
      <br>
      <!-- <p-progressBar [value]="cargando"></p-progressBar> -->
      <!-- <div fxLayout="row" class="titleCard"style="margin-top: 20px;"> -->
        <p-progressBar mode="indeterminate"  [style]="{'height': '6px'}"></p-progressBar>
  
      <!-- </div> -->
    
    </ng-template>
    </div>
  </p-dialog>
  <!-- guardar -->
  <p-dialog
    [(visible)]="Dialog1"
    [maximizable]="true"
    appendTo="body"
    [style]="{ height: 'auto', width: '40%' }"
    [resizable]="false"
    zindex="10000"
    [showHeader]="false"
    [closeOnEscape]="false"
    [closable]="false"
    [modal]="true"
  >
    <br />
    <div class="flex flex-column mt-3 font-family" style="flex: 1;">
      <div class="text-center">
        <i class="pi pi-exclamation-triangle" style="font-size: 3rem;"></i>
        <h4>Esta seguro de Modificar los Datos del Producto ?</h4>
        <p>Si para continuar</p>
      </div>
    </div>

    <ng-template pTemplate="footer" class="titleCard">
    <ng-template [ngIf]="motrar == false">

      <div style="text-align: center;">
        <button
          pButton
          pRipple
          label="Si"
          icon="pi pi-check"
          class="p-button-success p-button-raised p-button-rounded font-family"
          (click)="modifiacarProduct(productoSelect)"
        ></button>
        <button
          pButton
          pRipple
          label="No"
          style="color: rgb(31, 45, 64);"
          class="p-button-text font-family"
          icon="pi pi-times"
          (click)="Dialog1 = false"
        ></button>
      </div>
    </ng-template>

    <ng-template [ngIf]="motrar == true">
      <br>
      <br>
      <!-- <p-progressBar [value]="cargando"></p-progressBar> -->
      <!-- <div fxLayout="row" class="titleCard"style="margin-top: 20px;"> -->
        <p-progressBar mode="indeterminate"  [style]="{'height': '6px'}"></p-progressBar>
  
      <!-- </div> -->
    
    </ng-template>
    </ng-template>
  </p-dialog>
<!-- abonar a cuota o imprimir factura -->
<p-dialog [(visible)]="finalCompra" 
[style]="{'height': 'auto','width': '70%'}"  
[resizable]="false" zindex="10000" 
[closable]="false" [closeOnEscape]="false" 
[maximizable]="true" appendTo="body"
[showHeader]="false"
[modal]="true" styleClass="p-fluid border-round">
<ng-template [ngIf]="abonarCuota==false">
    <div class="flex align-items-center flex-column lg:flex-row 
lg:justify-content-between mb-3 mt-4 ng-tns-c38-5 ">
    <div class=" font-medium text-2xl text-900 font-family mr-2">
        <i class="pi pi-credit-card text-blue-500 text-xl bg-blue-100 border-round p-2" 
        ></i>
        Compra Registrada con exito
    </div>
    <div class="flex mt-3 lg:mt-0" >
      <a pbutton="" pripple="" icon="pi pi-home"  style="font-size:10px" (click)="cancelarCompra=true"
      class="p-ripple p-element p-button-rounded p-button-success p-button 
      p-component p-button-icon-only mr-2"><span class="p-ink"></span>
      <span class="p-button-icon pi pi-home" aria-hidden="true"></span>
      <span aria-hidden="true" class="p-button-label">&nbsp;</span>
    </a>
  </div>
</div>
<br>

<ul class="list-none p-0 m-0 flex flex-column md:flex-row">
    <li class="relative mr-0 md:mr-8 flex-auto">
        <div class="border-2 border-blue-500 surface-card border-round p-3 flex flex-column 
    md:flex-row align-items-center z-1">
    <i class="pi pi-shopping-cart text-orange-600 text-2xl md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i>
    <div>
        <div class="text-blue-600 font-medium mb-1">Forma de Pago</div>
        <span class="text-600 text-sm hidden md:block">{{compraCreada?.tipocompra}}</span>
    </div>
</div>
<div class="w-full absolute top-50 left-100 surface-300 hidden md:block" 
style="transform: translateY(-50%); height: 2px;"></div>
</li>
<li class="relative mr-0 md:mr-8 flex-auto">
    <div class="border-2 border-blue-500 surface-card border-round p-3 flex flex-column 
    md:flex-row align-items-center z-1">
    <i class="pi pi-money-bill text-orange-600 text-2xl md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i>
    <div>
        <div class="text-900 font-medium mb-1">Valor de Deuda</div>
            <span class="text-600 text-sm hidden md:block">$ {{compraCreada?.valor_deuda |  currency:'':'':'0.2-2'}}</span>
    </div>
</div>
<div class="w-full absolute top-50 left-100 surface-300 hidden md:block" 
    style="transform: translateY(-50%); height: 2px;"></div>
</li>
    <li class="relative flex-auto">
        <div class="border-1 surface-border surface-card border-round p-3 flex flex-column 
        md:flex-row align-items-center z-1"><i class="pi pi-check-circle text-green-500 text-2xl 
        md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i><div>
            <div class="text-900 font-medium mb-1">Estado de Compra</div>
            <span class="text-600 text-sm hidden md:block">{{compraCreada?.estado_compra | titlecase}}</span>
        </div>
    </div>
    </li>
  </ul>
    <div class="surface-section px-4 py-5">

        <div class="flex flex-wrap align-items-center justify-content-center gap-5">
          
            <div class="p-3 flex align-items-center bg-cyan-100" style="border-radius: 50px;" 
            style="cursor: pointer" (click)="imprimirFactura($event)">
                <div class="bg-cyan-500 inline-flex align-items-center justify-content-center 
                mr-3 h-3rem w-3rem border-circle"><i class="pi pi-arrow-right text-white text-2xl"></i>
                </div>
                <span class="text-cyan-900 text-lg font-medium">Imprimir factura</span>
            </div>
                <!-- <div class="p-3 flex align-items-center bg-orange-100" style="border-radius: 50px;">
                    <div class="bg-orange-500 inline-flex align-items-center justify-content-center
                     mr-3 h-3rem w-3rem border-circle"><i class="pi pi-shield text-white text-2xl"></i>
                    </div><span class="text-orange-900 text-lg font-medium">10 Year Warranty</span></div> -->
                   
                <div class="p-3 flex align-items-center bg-blue-100" 
                style="border-radius: 50px;cursor: pointer" (click)="abonarCuota=true"
                *ngIf="form.value.tipocompra?.value === 'CREDITO'">
                    <div class="bg-blue-500 inline-flex align-items-center justify-content-center 
                        mr-3 h-3rem w-3rem border-circle">
                        <i class="pi pi-shopping-bag text-white text-2xl"></i>
                    </div>
                    <span class="text-blue-900 text-lg font-medium">Registrar Abono a cuota</span>
                </div>
                <div class="p-3 flex align-items-center bg-green-100" style="border-radius: 50px;
                cursor: pointer" (click)="cancelarVentaR($event,2)">
                    <div class="bg-green-500 inline-flex align-items-center justify-content-center 
                    mr-3 h-3rem w-3rem border-circle"><i class="pi pi-refresh text-white text-2xl"></i>
                </div><span class="text-green-900 text-lg font-medium">Volver hacer otra compra</span>
            </div>
            </div>
            <br>
            <div style="border:1px solid gray; border-radius:5px;padding: 10px" *ngIf="ArchivoBoolean==false">
              
              <div class="grid">
                <div class="col-12 sm:col-6 border-right-1 p-3">
                  <div class="flex justify-content-center align-items-center mb-4 mt-2">
             
                    <i class="pi pi-image text-blue-500 text-xl bg-green-100 border-round p-2 mr-2" ></i>
                
                  <span class="block text-900  mb-2 text-xl font-medium">Vista Previa</span>
                </div>
                <br>
                <div class="flex justify-content-center align-items-center mb-4 mt-2">
                  <p-image [src]="imagenPrevia" alt="Image" width="400" [preview]="true"
                  imageClass="fullscreen ">
                  </p-image>
                </div>
               
          
                </div>
                <div class="col-12 sm:col-6">

                  <div class="flex justify-content-center align-items-center mb-4 mt-2">
               
                    <i class="pi pi-file text-blue-500 text-xl bg-green-100 border-round p-2 mr-2" ></i>
      
                  <span class="block text-900  mb-2 text-xl font-medium">Adjuntar Factura</span>
                </div>
                  <div class="flex justify-content-center align-items-center mb-4 mt-2">
    
                 
                    <div class="field font-family">
                      <div style="width:100%">
                      <input type="file" accept=".png, .jpg, .jpeg" pInputText id="factura" class="p-inputtext-sm" 
                      style="width:100%"
                      [(ngModel)]="producto.factura"  required autofocus 
                      (change)="onFileChange($event)"/>
                      <!-- <small class="p-error" *ngIf="submitted && !form.value.factura">factura is required.</small> -->
                    </div>
                  </div>
                </div>

                </div>
              </div>
            
            <div class="flex justify-content-center align-items-center mt-2">

              <button pbutton="" pripple="" label="Follow" style="width:auto;height: auto;"
              icon="pi pi-file"(click)="Archivodefactura()" 
              class="p-element p-ripple p-button-success mr-2 p-button p-component">
                  <span class="p-button-icon p-button-icon-left pi ppi-file" aria-hidden="true"></span>
                  <span class="p-button-label font-family">Registrar Factura</span>
                  <span class="p-ink" style="height: 116px; width: 116px; top: -40.5px; left: 20.375px;"></span>
              </button>
            </div>

            </div>
           
    </div>
</ng-template>
<!-- hacer el abono -->
    <ng-template [ngIf]="abonarCuota">
        <form [formGroup]="formCuota" novalidate>

            <br>
            <div style="border:1px solid gray; border-radius:5px;padding: 35px;">
                <div class="flex align-items-center flex-column lg:flex-row 
                lg:justify-content-between mb-3  ng-tns-c38-5 ">
                <div class=" font-medium text-2xl text-900 font-family mr-2">
                    <i class="pi pi-money-bill text-orange-500 text-xl bg-blue-100 border-round p-2" 
                    ></i>
                    Registrar Abono 
                </div>
                <div class="flex mt-3 lg:mt-0" *ngIf="abonarCuota==true">
                    <button pbutton="" pripple="" icon="pi pi-refresh"  style="font-size:10px"
                    (click)="VolverAbono($event)"
                    class="p-ripple p-element p-button-rounded p-button-success p-button 
                    p-component p-button-icon-only mr-2"><span class="p-ink"></span>
                    <span class="p-button-icon pi pi-refresh" aria-hidden="true"></span>
                    <span aria-hidden="true" class="p-button-label">&nbsp;</span>
                    </button>
                </div>
            </div>

                    <div class="field">
                        <label for="name"><span style="color:red">( * )</span> Tipo de Cuota</label>
                        <div class="flex font-family">
                            <div style="width:100%">
                              <p-dropdown class="visorg500-select-filter " 
                              [options]="tipo_cuota" [filter]="true"
                              [showClear]="true"
                              name="tipocuota" formControlName="tipocuota"  
                                  label="Seleccione Tipo de Cuota" 
                                  [style]="{'width':'100%','margin-bottom':'10px'}"
                                  optionvalue="value"  optionLabel="value" filterBy="value"
                                  [required]="true" placeholder="Seleccione Tipo de Cuota" 
                                  title="TIPO DE CUOTA" class="font-family">
                                  <ng-template let-option pTemplate="item">
                                  <span class="font-family">{{option.value | titlecase}} </span>
                              </ng-template>
                              </p-dropdown>
                            </div>
                          </div>
                        <!-- <p-inputNumber inputId="integeronly"  id="tipocuota" 
                        name="tipocuota" formControlName="tipocuota" [required]="true" autofocus >
                        </p-inputNumber> -->
                        <!-- <input type="text" pInputText id="cantidad_minima" 
                        name="cantidad_minima" formControlName="cantidad_minima" required autofocus /> -->
                        <small class="p-error" *ngIf="submitted && !form.value.tipocuota">Cantidad Minima is required.</small>
                    </div>
                    <div class="field">
                        <label for="name"><span style="color:red">( * )</span> Valor de Cuota</label>
                        <p-inputNumber  id="stock"  mode="decimal"  [minFractionDigits]="2"
                        name="valor_cuota" formControlName="valor_cuota" [required]="true" autofocus >
                        </p-inputNumber>

                        <!-- <input type="text" pInputText id="stock" 
                        name="stock" formControlName="stock" required autofocus /> -->
                        <small class="p-error" 
                        *ngIf="submitted && !form.value.valor_cuota">Valor de Cuota is required.</small>
                    </div>

            <br>
            <ng-template [ngIf]="motrar == false">
      
            <div class="flex align-items-center justify-content-center">
            <button pButton pRipple label="Registrar Abono" 
            icon="pi pi-check" style="width: auto;" class="p-button-info font-family" 
            (click)="registrarAbono($event)" [disabled]="!formCuota.valid"></button>
            </div>
          </ng-template>

          <ng-template [ngIf]="motrar == true">
            <br>
            <br>
            <!-- <p-progressBar [value]="cargando"></p-progressBar> -->
            <!-- <div fxLayout="row" class="titleCard"style="margin-top: 20px;"> -->
              <p-progressBar mode="indeterminate"  [style]="{'height': '6px'}"></p-progressBar>
        
            <!-- </div> -->
          
          </ng-template>
        </div>

        </form>
    </ng-template>


  

</p-dialog>



<!-- dialogos de confirmacion -->
<p-dialog [(visible)]="confirmarFinalizar" [maximizable]="true" appendTo="body"
[style]="{'height': 'auto','width': '40%'}"[resizable]="false" zindex="10000"
 [showHeader]="false" [closeOnEscape]="false" [closable]="false"
[modal]="true" >
<br>
    <div class="flex flex-column mt-3 font-family" style="flex: 1">
        <div class="text-center">
            <i class="pi pi-exclamation-triangle" style="font-size: 3rem"></i>
            <h4>Esta seguro de Finalizar esta Compra ?</h4>
            <p>Si para continuar</p>
        </div>
    </div>

    <ng-template pTemplate="footer" class="titleCard" >
    <ng-template [ngIf]="motrar == false">

      <div style="text-align: center;">
        <button pButton pRipple label="Si" icon="pi pi-check" 
        class="p-button-success p-button-raised p-button-rounded font-family" 
        (click)="facturar($event)"></button>
        <button pButton pRipple label="No"  style="color: rgb(31, 45, 64);" 
        class=" p-button-text font-family" icon="pi pi-times"  (click)="confirmarFinalizar = false"  ></button>
      </div>
    </ng-template>

    <ng-template [ngIf]="motrar == true">
      <br>
      <br>
      <!-- <p-progressBar [value]="cargando"></p-progressBar> -->
      <!-- <div fxLayout="row" class="titleCard"style="margin-top: 20px;"> -->
        <p-progressBar mode="indeterminate"  [style]="{'height': '6px'}"></p-progressBar>
  
      <!-- </div> -->
    
    </ng-template>
    </ng-template>
</p-dialog>
<!-- 
<p-dialog [(visible)]="confirmarRegistro" [maximizable]="true" appendTo="body"
[style]="{'height': 'auto','width': '40%'}"[resizable]="false" zindex="10000"
 [showHeader]="false" [closeOnEscape]="false" [closable]="false"
[modal]="true" >
<br>
    <div class="flex flex-column mt-3 font-family" style="flex: 1">
        <div class="text-center">
            <i class="pi pi-exclamation-triangle" style="font-size: 3rem"></i>
            <h4>Esta seguro de Registrar Productos ?</h4>
            <p>Si para continuar</p>
        </div>
    </div>

    <ng-template pTemplate="footer" class="titleCard" >
      <div style="text-align: center;">
        <button pButton pRipple label="Si" icon="pi pi-check" 
        class="p-button-success p-button-raised p-button-rounded font-family" (click)="enviarDatos($event)"></button>
        <button pButton pRipple label="No"  style="color: rgb(31, 45, 64);" 
        class=" p-button-text font-family" icon="pi pi-times"  (click)="confirmarRegistro = false"  ></button>
      </div>
    </ng-template>
</p-dialog> -->


<p-dialog [(visible)]="cancelarCompra" [maximizable]="true" appendTo="body"
[style]="{'height': 'auto','width': '40%'}"[resizable]="false" zindex="10000"
 [showHeader]="false" [closeOnEscape]="false" [closable]="false"
[modal]="true" >
<br>
    <div class="flex flex-column mt-3 font-family" style="flex: 1">
        <div class="text-center">
            <i class="pi pi-exclamation-triangle" style="font-size: 3rem"></i>
            <h4>Esta seguro de Volver al inicio de las Compras?</h4>
            <p>Si para continuar</p>
        </div>
    </div>

    <ng-template pTemplate="footer" class="titleCard" >
      <div style="text-align: center;">
        <button pButton pRipple label="Si" icon="pi pi-check" 
        class="p-button-success p-button-raised p-button-rounded font-family" 
        (click)="cancelarVentaR($event,1)"></button>
        <button pButton pRipple label="No"  style="color: rgb(31, 45, 64);" 
        class=" p-button-text font-family" icon="pi pi-times"  (click)="cancelarCompra = false"  ></button>
      </div>
    </ng-template>
</p-dialog>

<p-dialog [(visible)]="cerrarRegistro" [maximizable]="true" appendTo="body"
[style]="{'height': 'auto','width': '40%'}"[resizable]="false" zindex="10000"
 [showHeader]="false" [closeOnEscape]="false" [closable]="false"
[modal]="true" >
<br>
    <div class="flex flex-column mt-3 font-family" style="flex: 1">
        <div class="text-center">
            <i class="pi pi-exclamation-triangle" style="font-size: 3rem"></i>
            <h4>A requerio cerrar la sesion de registrar productos</h4>
            <p>¿¿Desea consevar estos datos iniciales??</p>
        </div>
    </div>

    <ng-template pTemplate="footer" class="titleCard" >
      <div style="text-align: center;">
        <button pButton pRipple label="Si" icon="pi pi-check" 
        class="p-button-success p-button-raised p-button-rounded font-family" (click)="conservarP($event)"></button>
        <button pButton pRipple label="No"  style="color: rgb(31, 45, 64);" 
        class=" p-button-text font-family" icon="pi pi-times"  (click)="borrarP($event)"  ></button>
      </div>
    </ng-template>
</p-dialog>


</ng-template>


<p-dialog 
[resizable]="false" [modal]="true" [showHeader]="false"
[maximizable]="true" appendTo="body" [(visible)]="ArchivoBooleanModal" 
[style]="{width: '75%'}" [contentStyle]="{height: 'auto'}" >
<div class="flex align-items-center flex-column lg:flex-row 
lg:justify-content-between mb-3 mt-4 ng-tns-c38-5 ">
    <div class=" font-medium text-2xl text-900 font-family mr-2">
        <i class="pi pi-book text-blue-500 text-xl bg-blue-100 border-round p-2" 
        ></i>
        Numero de Compra : {{producto.numero }}
    </div>
    <div class="mt-3 lg:mt-0" >
        <div pButton class="border-1 surface-border surface-card border-round mr-3">
        <i class="pi pi-check-circle text-green-500 text-2xl 
        md:text-4xl mb-2 md:mb-0 mr-0 md:mr-3"></i>
        <div>
            <div class="text-900 font-medium mb-1">Estado de Compra</div>
            <span class="text-600 text-sm hidden md:block">{{producto.estado_compra| titlecase}}</span>
        </div>
        </div>
        <button pbutton="" pripple="" icon="pi pi-times"  style="font-size:10px" 
        (click)="ArchivoBooleanModal = false"
        class="p-ripple p-element p-button-rounded p-button-success p-button 
        p-component p-button-icon-only mr-2"><span class="p-ink"></span>
        <span class="p-button-icon pi pi-times" aria-hidden="true"></span>
        <span aria-hidden="true" class="p-button-label">&nbsp;</span>
        </button>

    </div>
</div>
<div style="border:1px solid gray; border-radius:5px;padding: 10px" *ngIf="ArchivoBooleanModal==true">
  
  <div class="grid">
<!-- 
    <p-fileUpload name="demo[]" (onUpload)="onUpload($event)"
    [multiple]="false" accept="image/*" [maxFileSize]="1000000" >
    <ng-template pTemplate="content">
        <ul *ngIf="uploadedFiles.length">
            <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
        </ul>
    </ng-template>
</p-fileUpload> -->

    <ng-template [ngIf]="producto.factura != null">
      <div class="col-12 sm:col-6 border-right-1 p-3">
        <div class="flex justify-content-center align-items-center mb-4 mt-2">
   
          <i class="pi pi-file text-blue-500 text-xl bg-green-100 border-round p-2 mr-2" ></i>
      
        <span class="block text-900  mb-2 text-xl font-medium">Factura Anterior</span>
      </div>
      <br>
      <div class="flex justify-content-center align-items-center mb-4 mt-2">
        <p-image [src]="producto.factura" alt="Image" width="400" [preview]="true"
        imageClass="fullscreen ">
        </p-image>
      </div>
     

      </div>
      <div class="col-12 sm:col-6">
        <div class="flex justify-content-center align-items-center mb-4 mt-2">
   
          <i class="pi pi-file text-blue-500 text-xl bg-green-100 border-round p-2 mr-2" ></i>
      
        <span class="block text-900  mb-2 text-xl font-medium">Adjuntar Factura</span>
      </div>
        <div class="flex justify-content-center align-items-center mb-4 mt-2">
      
       
          <div class="field font-family">
            <div style="width:100%">
            <input type="file" accept=".png, .jpg, .jpeg" pInputText id="factura" 
            class="p-inputtext-sm" enctype="multipart/form-data"
            style="width:100%"  required autofocus 
            (change)="onFileChange($event)"/>
          </div>
        </div>
      </div>
      <ng-template [ngIf]="motrar == false">

      <div class="flex justify-content-center align-items-center mt-2" >
        <ng-template [ngIf]="producto.id != undefined">
        
          <button pbutton="" pripple="" label="Follow" style="width:auto;height: auto;"
          
          icon="pi pi-file"(click)="actualizar_factura(producto)" [disabled]="producto.factura==null"
          class="p-element p-ripple p-button-warning mr-2 p-button p-component">
              <span class="p-button-icon p-button-icon-left pi ppi-file" aria-hidden="true"></span>
              <span class="p-button-label font-family">Actualizar Factura</span>
              <span class="p-ink" style="height: 116px; width: 116px; top: -40.5px; left: 20.375px;"></span>
          </button>
        </ng-template>
        
        </div>
      </ng-template>

      <ng-template [ngIf]="motrar == true">
        <br>
        <br>
        <!-- <p-progressBar [value]="cargando"></p-progressBar> -->
        <!-- <div fxLayout="row" class="titleCard"style="margin-top: 20px;"> -->
          <p-progressBar mode="indeterminate"  [style]="{'height': '6px'}"></p-progressBar>
    
        <!-- </div> -->
      
      </ng-template>

      </div>
    </ng-template>
    <ng-template [ngIf]="producto.factura == null">
      <div class="col-12 sm:col-12">
        <div class="flex justify-content-center align-items-center mb-4 mt-2">
   
          <i class="pi pi-file text-blue-500 text-xl bg-green-100 border-round p-2 mr-2" ></i>
      
        <span class="block text-900  mb-2 text-xl font-medium">Adjuntar Factura</span>
      </div>
        <div class="flex justify-content-center align-items-center mb-4 mt-2">
      
       
          <div class="field font-family">
            <div style="width:100%">
            <input type="file" accept=".png, .jpg, .jpeg" 
             id="factura" class="p-inputtext-sm" enctype="multipart/form-data"
            style="width:100%"  required autofocus 
            (change)="onFileChange($event)"/>
          </div>
        </div>

        <div>
          <img width="100px" [src]="imagenPrevia" alt="">
      </div>
      
      </div>
      <ng-template [ngIf]="motrar == false">

      <div class="flex justify-content-center align-items-center mt-2" >
        <ng-template [ngIf]="producto.id != undefined">
        
          <button pbutton="" pripple="" label="Follow" style="width:auto;height: auto;"
          
          icon="pi pi-file"(click)="actualizar_factura(producto)"
           [disabled]="archivo==null"
          class="p-element p-ripple p-button-warning mr-2 p-button p-component">
              <span class="p-button-icon p-button-icon-left pi ppi-file" aria-hidden="true"></span>
              <span class="p-button-label font-family">Actualizar Factura</span>
              <span class="p-ink" style="height: 116px; width: 116px; top: -40.5px; left: 20.375px;"></span>
          </button>
        </ng-template>
        
        </div>

      </ng-template>

      <ng-template [ngIf]="motrar == true">
        <br>
        <br>
        <!-- <p-progressBar [value]="cargando"></p-progressBar> -->
        <!-- <div fxLayout="row" class="titleCard"style="margin-top: 20px;"> -->
          <p-progressBar mode="indeterminate"  [style]="{'height': '6px'}"></p-progressBar>
    
        <!-- </div> -->
      
      </ng-template>
      </div>
    </ng-template>

  </div>


</div>

</p-dialog>
</div>

</ng-template>

<ng-template [ngIf]="noestasPermitido">
  <img [src]="noAutorizado" alt="" srcset="" style="width:100%">
</ng-template>